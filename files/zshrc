setopt autocd
setopt autopushd

export LC_ALL=C.UTF-8
export LANG=C.UTF-8
export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin
export PATH=$PATH:'/mnt/c/Users/tomakabe/AppData/Local/Programs/Microsoft VS Code/bin'
export EDITOR=vim
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

function jump-to-ghq-dir {
  cd "$( ghq list --full-path | peco)"
}

PROMPT="%# "

alias ll="ls -alh"
alias jgit='jump-to-ghq-dir'
alias phist='history | peco'
alias k=kubectl
# Workaround https://github.com/docker/for-win/issues/6391
alias kubectl="/usr/bin/kubectl"
alias tf-state-cleanup='terraform state list | cut -f 1 -d "[" | xargs -L 1 terraform state rm'

eval "$(jump shell)"

if [ -e $HOME/.zsh-completions/src ]; then
  fpath=($HOME/.zsh-completions/src $fpath)
fi

if [ -f "$HOME/.zfunc/_rustup" ]; then
  FPATH=$HOME/.zfunc:$FPATH
fi

autoload -Uz +X compinit && compinit -u
autoload -Uz +X bashcompinit && bashcompinit

source /etc/bash_completion.d/azure-cli

source <(kubectl completion zsh)
complete -o default -F __start_kubectl k

source <(helm completion zsh)

complete -o nospace -C /usr/bin/terraform terraform

. "$HOME/.cargo/env"

command -v flux >/dev/null && . <(flux completion zsh) && compdef _flux flux

export DOCKER_BUILDKIT=1
DOCKER_DISTRO="Ubuntu-20.04"
DOCKER_DIR=/mnt/wsl/shared-docker
DOCKER_SOCK="$DOCKER_DIR/docker.sock"
export DOCKER_HOST="unix://$DOCKER_SOCK"
if [ -S "$DOCKER_SOCK" ]; then
#if [ ! -S "$DOCKER_SOCK" ]; then
#    mkdir -p "$DOCKER_DIR"
#    chmod o=,g=rx "$DOCKER_DIR"
#    chgrp docker "$DOCKER_DIR"
    /mnt/c/Windows/System32/wsl.exe -d $DOCKER_DISTRO sh -c "nohup sudo -b dockerd < /dev/null > $DOCKER_DIR/dockerd.log 2>&1"
fi
